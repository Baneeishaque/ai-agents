---
name: Harper Linting Suppression Protocol
description: Standardized rules and procedures for addressing, suppressing, and resolving false positives generated by the Harper linter across Python code, docstrings, and Markdown files.
category: Linting
---

# Harper Linting Suppression Protocol

***

## 1. Scope and Context

[Link to Harper VS Code Extension](https://open-vsx.org/extension/elijah-potter/harper).

Harper is a privacy-focused grammar and spelling checker. While useful, it frequently generates false
positives in technical contexts, specifically concerning:

- Shebang lines (`usr`, `env`, `python3`).
- File extensions and directory names used in code or documentation (`md`, `DIR`).
- Standard programmatic punctuation misinterpreted as typographical errors (e.g., Markdown dividers `---` or
  comment blocks `<!-- -->` in docstrings).
- Grammatical suggestions that conflict with idiomatic code documentation ("appends to" vs. "appends entries into").

This skill defines the industrial standard for suppressing these errors while maintaining high documentation quality.

***

## 2. Suppression Strategies

The following strategies MUST be employed, in order of preference, to resolve Harper linting errors.

### 1. Prose Rewriting (the Preferred Solution)

Harper's language-server parser for Python is extremely strict and largely broken for inline or previous-line
Ignores when dealing with docstrings (`"""..."""`). It processes Python docstrings as prose. The safest
way to avoid Harper parsing issues—especially for punctuation and file extensions within Python docstrings or
comments—is to rewrite the text in descriptive plain English.

**Rules:**

- **Do not use literal file extensions** (`.md`, `SKILL.md`) in docstrings if Harper flags them. Rewrite to
  use descriptive nouns (e.g., "Markdown files", "SKILL Markdown files").
- **Distinguish Extensions from Proper Nouns:** `md` is a file extension, not an acronym. The industry standard
  for file extensions is lowercase (`.md`, `.py`, `.txt`). Harper's "canonical spelling is all-caps" rule is
  designed for abbreviations/acronyms (e.g., USA, API), not file extensions. This is a Harper false positive.
  Only capitalize "Markdown" when referring to the language as a proper noun.
- **Avoid literal syntax descriptions:** If Harper misinterprets Markdown syntax (like `---` or `<!-- -->`), avoid
  typing the literal characters. Describe the syntax instead (e.g., "YAML front matter", "XML comments").
    - *Context:* When Harper sees `--` in prose, it applies typography rules assuming they are punctuation being typeset.
      It has no way to know those hyphens are part of HTML comment or YAML delimiter syntax being described.
- **Adopt suggested grammar carefully:** If Harper suggests a grammatical fix (e.g., "appends to" -> "ToTwoToo" error),
  evaluate if a slight rephrasing (e.g., "appends entries into") maintains clarity while satisfying the linter.

### 2. Workspace Dictionary (`.harper-dictionary.txt`)

Harper uses a "workspace dictionary" (which functions as a project dictionary) located by default at
`.harper-dictionary.txt` in the root of your project or workspace. This dictionary is a simple plaintext file where
each word to be ignored or recognized is on its own line. Its location can be configured. Harper automatically detects
this file and stops flagging these code terms across the entire project. For valid technical terminology, abbreviations,
and literal code strings that appear consistently across the project, add them to this workspace dictionary.

**Location:** `/Users/dk/lab-data/ai-agents/.harper-dictionary.txt`

**Rules for Addition:**

- Add terms only after confirming they are required literals, not actual typos.
- Commonly added terms include:
    - Shebang components: `usr`, `env`, `python3`
    - Extensions/Variables: `md`, `DIR`, `ASC`, `DESC`

### 3. Standalone Ignore Directives (`harper:ignore`)

When a line of code or a comment must remain exactly as written and cannot be added to the global dictionary,
use the `harper:ignore` directive.

**Critical Limitations:**

- The official supported ignore keyword is all-lowercase `harper:ignore` or `harper: ignore`.
- The directive **MUST** be the first thing in the comment, on its own standalone line immediately preceding
  the flagged line, or on the same line if it's the only content.
- Inline ignores appended to the end of a different comment are **NOT** supported and are aggressively stripped
  by formatting tools (like `ruff`). **NEVER use inline ignores.**

**Correct Usage (Python):**

```python
# harper:ignore
# This specific comment with weird-formatting needs to be ignored
```

**Correct Usage (JavaScript/TypeScript):**

```javascript
// harper:ignore
// This specific comment with weird-formatting needs to be ignored
```

***

## 3. Environment & Dependencies

When dealing with `harper-cli` as a system-wide tool, you MUST consult the System-Wide Tool Management skill
(`system-wide-tool-management/SKILL.md`).

To run the Harper CLI linter and analyze its output:

```bash
# Run harper-cli on a target file and save the output to a file for analysis
/opt/homebrew/bin/harper-cli lint /Users/dk/lab-data/ai-agents/ai-agent-rules/scripts/sync_rules.py > harper_output.txt 2>&1 || true
```

**Command Breakdown:**

- `/opt/homebrew/bin/harper-cli`: The absolute path to the bare executable (avoiding wrapper tools).
- `lint`: The subcommand instructing Harper to check the specified file.
- `[target_file]`: The file being linted.
- `> harper_output.txt 2>&1`: Redirects both standard output and standard error (`2>&1`) into a text file for
  subsequent analysis.
- `|| true`: Prevents the script or agent command execution from halting if the linter finds errors
  (which results in a nonzero exit status).

**Important:** You must explicitly point the CLI to the workspace dictionary using the `-u` or
`--user-dict-path` flag to ensure it respects the project's ignored words.

```bash
/opt/homebrew/bin/harper-cli lint --user-dict-path /Users/dk/lab-data/ai-agents/.harper-dictionary.txt \
  /Users/dk/lab-data/ai-agents/ai-agent-rules/scripts/sync_rules.py
```

**Command Breakdown:**

- `--user-dict-path`: Specifies the absolute path to the custom dictionary file, enabling project-specific
  suppressions.

Always verify the CLI output explicitly states: `Note: Using user dictionary at ...`.

***

## 4. Harper Error Handling & Consultative Workflow

**Consultative Workflow:** Some of the Harper auto-fixes are incorrect - do not use them blindly. You must
deeply analyze each suggestion and consult the user one by one on the fixes, acting according to their feedback.

Here are examples of how to handle common suggestions:

- **Shebangs (`usr`, `env`, `python3`)**: Harper flags these as spelling errors. **Recommendation: Ignore**
  (add to workspace dictionary).
- **File Extensions vs Acronyms (`md`)**: Harper suggests `MD`. **Recommendation: Rewrite in plain English prose**.
- **Code Literals (`ASC`, `DIR`)**: Harper flags these. **Recommendation: Ignore** (add to workspace dictionary).
- **Hyphens in Docstrings (`---`, `<!-- -->`)**: Harper flags `--` as typography errors. **Recommendation: Rewrite
  in plain English**.
- **Typos in compound words (`YAML frontmatter`)**: Harper suggests splitting (`YAML front matter`).
  **Recommendation: Apply the split**.
- **Capitalization (`markdown`)**: Harper suggests `Markdown` depending on context. **Recommendation: Apply
  capitalization** when used as a proper noun, but not for file extensions.
- **Word Choice (`appends to`)**: Harper flags `to` (ToTwoToo rule). **Recommendation: Rephrase** to `appends entries into`.

***

## 5. IDE Versus CLI Parity

Always remember that the VS Code Harper extension and the `harper-cli` may interpret code blocks and extensions
differently.

- If a suppression technique works in VS Code but fails in the CLI, **the CLI behavior represents the source of truth.**
- Prose rewriting is the only universally reliable technique for resolving discrepancies between the IDE and the CLI.

***

## 6. Workflow Integration

When encountering a Harper error during development:

1. Is it a true typo? Fix it.
2. Is it a grammar suggestion? Try to rephrase idiomatically.
3. Is it a literal file extension or punctuation in a docstring? Rewrite in plain English prose.
4. Is it a common technical abbreviation or shebang component? Add to `.harper-dictionary.txt`.
5. Is it a highly specific, unavoidable literal line? Precede it with a standalone `# harper:ignore`.

***

## 7. Related Conversations & Traceability

- **Implementation Session**: [Implementation Session Log](../../../docs/conversations/2026-02-22-harper-linting-suppression-skill.md)
